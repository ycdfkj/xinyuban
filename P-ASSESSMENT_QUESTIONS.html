<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心愈伴 - 心理测评</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'glass-bg': 'rgba(255, 255, 255, 0.1)',
                        'glass-border': 'rgba(255, 255, 255, 0.2)',
                        'dark-glass': 'rgba(0, 0, 0, 0.1)',
                    },
                    backdropBlur: {
                        'xs': '2px',
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                        'glass-inset': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.4);
        }
        
        .glass-button:disabled {
            background: rgba(255, 255, 255, 0.1);
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #ffffff, #e5e7eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .option-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .option-card:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.6);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }
        
        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #ffffff;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans text-white">
    <!-- iOS状态栏 -->
    <div id="status-bar" class="flex justify-between items-center px-6 py-2 text-sm font-medium">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-xs"></i>
            <i class="fas fa-wifi text-xs"></i>
            <div class="w-6 h-3 border border-white rounded-sm">
                <div class="w-4 h-1.5 bg-white rounded-sm m-0.5"></div>
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div id="main-content" class="px-4 py-6 min-h-screen">
        <!-- 顶部导航栏 -->
        <header id="top-nav" class="flex items-center justify-between mb-6">
            <button id="back-btn" class="flex items-center space-x-2 glass-button rounded-full px-4 py-2">
                <i class="fas fa-arrow-left"></i>
                <span class="text-sm">返回</span>
            </button>
            <div id="progress-info" class="text-center">
                <h1 id="scale-title" class="text-lg font-semibold gradient-text">抑郁自评量表</h1>
                <p id="question-progress" class="text-sm text-white/70">第 1 题 / 共 20 题</p>
            </div>
            <div class="w-20"></div> <!-- 占位元素保持居中 -->
        </header>

        <!-- 进度条 -->
        <div id="progress-section" class="mb-6">
            <div class="progress-bar h-2 mb-2">
                <div id="progress-fill" class="progress-fill" style="width: 5%;"></div>
            </div>
            <p id="progress-text" class="text-sm text-white/70 text-center">已完成 5%</p>
        </div>

        <!-- 题目卡片 -->
        <div id="question-card" class="glass-card rounded-3xl p-6 mb-6 fade-in">
            <div id="question-number" class="text-sm text-white/70 mb-4">
                <span class="bg-primary/30 px-3 py-1 rounded-full">问题 1</span>
            </div>
            <h2 id="question-text" class="text-xl font-semibold mb-6 leading-relaxed">
                我感到情绪沮丧，郁闷
            </h2>
            
            <!-- 选项列表 -->
            <div id="options-list" class="space-y-3">
                <div class="option-card rounded-2xl p-4" data-value="1">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-6 h-6 border-2 border-white/30 rounded-full flex items-center justify-center">
                                <div class="w-3 h-3 bg-white rounded-full opacity-0"></div>
                            </div>
                            <span class="text-base">没有或很少时间</span>
                        </div>
                        <span class="text-sm text-white/50">1分</span>
                    </div>
                </div>
                
                <div class="option-card rounded-2xl p-4" data-value="2">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-6 h-6 border-2 border-white/30 rounded-full flex items-center justify-center">
                                <div class="w-3 h-3 bg-white rounded-full opacity-0"></div>
                            </div>
                            <span class="text-base">小部分时间</span>
                        </div>
                        <span class="text-sm text-white/50">2分</span>
                    </div>
                </div>
                
                <div class="option-card rounded-2xl p-4" data-value="3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-6 h-6 border-2 border-white/30 rounded-full flex items-center justify-center">
                                <div class="w-3 h-3 bg-white rounded-full opacity-0"></div>
                            </div>
                            <span class="text-base">相当多时间</span>
                        </div>
                        <span class="text-sm text-white/50">3分</span>
                    </div>
                </div>
                
                <div class="option-card rounded-2xl p-4" data-value="4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-6 h-6 border-2 border-white/30 rounded-full flex items-center justify-center">
                                <div class="w-3 h-3 bg-white rounded-full opacity-0"></div>
                            </div>
                            <span class="text-base">绝大部分或全部时间</span>
                        </div>
                        <span class="text-sm text-white/50">4分</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 导航按钮 -->
        <div id="navigation-buttons" class="flex space-x-4 mb-6">
            <button id="prev-btn" class="flex-1 glass-button rounded-2xl py-4 disabled:opacity-50" disabled>
                <i class="fas fa-arrow-left mr-2"></i>
                上一题
            </button>
            <button id="next-btn" class="flex-1 bg-primary hover:bg-primary/80 rounded-2xl py-4 transition-all disabled:opacity-50" disabled>
                下一题
                <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>

        <!-- 提交按钮（最后一题显示） -->
        <div id="submit-section" class="hidden">
            <button id="submit-btn" class="w-full bg-gradient-to-r from-primary to-secondary hover:from-primary/80 hover:to-secondary/80 rounded-2xl py-4 font-semibold text-lg transition-all shadow-lg">
                <i class="fas fa-check mr-2"></i>
                提交测评
            </button>
        </div>

        <!-- 加载中遮罩 -->
        <div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
            <div class="glass-card rounded-3xl p-8 text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-lg font-semibold">正在计算您的测评结果...</p>
                <p class="text-sm text-white/70 mt-2">请稍候</p>
            </div>
        </div>
    </div>

    <script>
        // 测评数据
        const assessmentData = {
            'depression': {
                title: '抑郁自评量表',
                questions: [
                    { text: '我感到情绪沮丧，郁闷', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到早晨心情最好', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我要哭或想哭', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我夜间睡眠不好', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我吃饭像平时一样多', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的性功能正常', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到体重减轻', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我为便秘烦恼', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的心跳比平时快', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我无故感到疲劳', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的头脑像往常一样清楚', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我做事情像平时一样不感到困难', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我坐卧不安，难以保持平静', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我对未来感到有希望', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我比平时更容易激怒', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我觉得决定什么事很容易', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到自己是有用的和不可缺少的人', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的生活很有意义', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我仍然喜爱自己平时喜爱的东西', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到自己的精力下降，活动减慢', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] }
                ]
            },
            'anxiety': {
                title: '焦虑自评量表',
                questions: [
                    { text: '我感到比往常更加神经过敏和焦虑', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我无缘无故感到担心', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我容易心烦意乱或感到恐慌', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到我的身体好像被分成几块，支离破碎', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到事事都很顺利，不会有倒霉的事情发生', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的四肢抖动和震颤', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我因头痛、颈痛和背痛而烦恼', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到无力且容易疲劳', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到很平静，能安静坐下来', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我感到我的心跳较快', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我因阵阵的眩晕而不舒服', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我有阵阵要晕倒的感觉', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我呼吸时进气和出气都不费力', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的手指和脚趾感到麻木和刺痛', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我因胃痛和消化不良而苦恼', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我必须时常排尿', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我的手总是温暖而干燥', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我觉得脸发烧发红', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我容易入睡，晚上休息很好', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] },
                    { text: '我做噩梦', options: ['没有或很少时间', '小部分时间', '相当多时间', '绝大部分或全部时间'] }
                ]
            },
            'sleep': {
                title: '睡眠质量量表',
                questions: [
                    { text: '您对自己的睡眠质量满意吗？', options: ['非常满意', '满意', '一般', '不满意', '非常不满意'] },
                    { text: '您入睡需要多长时间？', options: ['15分钟以内', '15-30分钟', '30-60分钟', '60分钟以上'] },
                    { text: '您晚上醒来的次数？', options: ['从不醒来', '1次', '2-3次', '4次以上'] },
                    { text: '您早上醒来的时间？', options: ['比期望早1小时以上', '比期望早30-60分钟', '按时醒来', '比期望晚30分钟以内'] },
                    { text: '您醒来后的感觉？', options: ['精力充沛', '比较清醒', '一般', '疲倦', '非常疲倦'] },
                    { text: '您白天的精神状态？', options: ['很好', '较好', '一般', '较差', '很差'] },
                    { text: '您白天的活动受睡眠影响吗？', options: ['不受影响', '轻微影响', '中度影响', '严重影响'] },
                    { text: '您是否使用睡眠药物？', options: ['从不使用', '偶尔使用', '经常使用', '每天使用'] },
                    { text: '您是否有打鼾？', options: ['从不打鼾', '偶尔打鼾', '经常打鼾', '总是打鼾'] },
                    { text: '您对自己的睡眠状况担忧吗？', options: ['从不担忧', '偶尔担忧', '经常担忧', '总是担忧'] }
                ]
            },
            'love_relationship': {
                title: '恋爱关系评估',
                questions: [
                    { text: '我对这段关系感到满意', options: ['非常不满意', '不满意', '一般', '满意', '非常满意'] },
                    { text: '我和伴侣之间有良好的沟通', options: ['非常不同意', '不同意', '一般', '同意', '非常同意'] },
                    { text: '我感到被伴侣理解和支持', options: ['非常不同意', '不同意', '一般', '同意', '非常同意'] },
                    { text: '我和伴侣之间有共同的兴趣爱好', options: ['几乎没有', '很少', '一般', '较多', '很多'] },
                    { text: '我对伴侣的未来感到乐观', options: ['非常不乐观', '不乐观', '一般', '乐观', '非常乐观'] },
                    { text: '我和伴侣能够有效解决冲突', options: ['几乎不能', '很少能', '一般', '经常能', '总是能'] },
                    { text: '我感到在这段关系中有安全感', options: ['非常不安全', '不安全', '一般', '安全', '非常安全'] },
                    { text: '我愿意为这段关系付出努力', options: ['非常不愿意', '不愿意', '一般', '愿意', '非常愿意'] },
                    { text: '我和伴侣之间有身体上的亲密感', options: ['几乎没有', '很少', '一般', '较多', '很多'] },
                    { text: '我认为这段关系有长期发展的潜力', options: ['几乎没有', '很少', '一般', '较多', '很多'] }
                ]
            },
            'career_interest': {
                title: '职业兴趣测评',
                questions: [
                    { text: '我喜欢与人交流和沟通', options: ['非常不喜欢', '不喜欢', '一般', '喜欢', '非常喜欢'] },
                    { text: '我对科学和技术很感兴趣', options: ['非常不感兴趣', '不感兴趣', '一般', '感兴趣', '非常感兴趣'] },
                    { text: '我喜欢艺术和创意活动', options: ['非常不喜欢', '不喜欢', '一般', '喜欢', '非常喜欢'] },
                    { text: '我擅长组织和管理事务', options: ['非常不擅长', '不擅长', '一般', '擅长', '非常擅长'] },
                    { text: '我喜欢帮助他人解决问题', options: ['非常不喜欢', '不喜欢', '一般', '喜欢', '非常喜欢'] },
                    { text: '我对商业和金融感兴趣', options: ['非常不感兴趣', '不感兴趣', '一般', '感兴趣', '非常感兴趣'] },
                    { text: '我喜欢动手制作和修理东西', options: ['非常不喜欢', '不喜欢', '一般', '喜欢', '非常喜欢'] },
                    { text: '我擅长分析和解决复杂问题', options: ['非常不擅长', '不擅长', '一般', '擅长', '非常擅长'] },
                    { text: '我喜欢在团队中工作', options: ['非常不喜欢', '不喜欢', '一般', '喜欢', '非常喜欢'] },
                    { text: '我对自己的职业发展有明确的规划', options: ['非常不明确', '不明确', '一般', '明确', '非常明确'] }
                ]
            }
        };

        // 全局变量
        let currentScaleId = 'depression'; // 默认量表
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let currentScaleData = null;

        document.addEventListener('DOMContentLoaded', function() {
            // 解析URL参数
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const urlParams = new URLSearchParams(queryString);
                
                for(const [key, value] of urlParams.entries()) {
                    params[key] = value;
                }
                return params;
            }

            // 初始化页面
            function initializePage() {
                const params = getUrlParams();
                currentScaleId = params.scaleId || 'depression';
                currentScaleData = assessmentData[currentScaleId];
                
                if (!currentScaleData) {
                    console.error('量表数据未找到，使用默认量表');
                    currentScaleData = assessmentData['depression'];
                }
                
                userAnswers = Array(currentScaleData.questions.length).fill(null);
                updatePageContent();
            }

            // 更新页面内容
            function updatePageContent() {
                // 更新量表标题
                document.querySelector('#scale-title').textContent = currentScaleData.title;
                
                // 更新进度信息
                const totalQuestions = currentScaleData.questions.length;
                const progressText = `第 ${currentQuestionIndex + 1} 题 / 共 ${totalQuestions} 题`;
                document.querySelector('#question-progress').textContent = progressText;
                
                // 更新进度条
                const progressPercent = ((currentQuestionIndex + 1) / totalQuestions) * 100;
                document.querySelector('#progress-fill').style.width = `${progressPercent}%`;
                document.querySelector('#progress-text').textContent = `已完成 ${Math.round(progressPercent)}%`;
                
                // 更新题目内容
                const currentQuestion = currentScaleData.questions[currentQuestionIndex];
                document.querySelector('#question-number').innerHTML = `<span class="bg-primary/30 px-3 py-1 rounded-full">问题 ${currentQuestionIndex + 1}</span>`;
                document.querySelector('#question-text').textContent = currentQuestion.text;
                
                // 更新选项
                const optionsList = document.querySelector('#options-list');
                optionsList.innerHTML = '';
                
                currentQuestion.options.forEach((optionText, optionIndex) => {
                    const optionValue = optionIndex + 1;
                    const isSelected = userAnswers[currentQuestionIndex] === optionValue;
                    
                    const optionElement = document.createElement('div');
                    optionElement.className = `option-card rounded-2xl p-4 ${isSelected ? 'selected' : ''}`;
                    optionElement.dataset.value = optionValue;
                    
                    optionElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-6 h-6 border-2 border-white/30 rounded-full flex items-center justify-center">
                                    <div class="w-3 h-3 bg-white rounded-full ${isSelected ? 'opacity-100' : 'opacity-0'}"></div>
                                </div>
                                <span class="text-base">${optionText}</span>
                            </div>
                            <span class="text-sm text-white/50">${optionValue}分</span>
                        </div>
                    `;
                    
                    optionsList.appendChild(optionElement);
                });
                
                // 更新按钮状态
                updateButtonStates();
                
                // 添加淡入动画
                const questionCard = document.querySelector('#question-card');
                questionCard.classList.remove('fade-in');
                setTimeout(() => {
                    questionCard.classList.add('fade-in');
                }, 100);
            }

            // 更新按钮状态
            function updateButtonStates() {
                const prevBtn = document.querySelector('#prev-btn');
                const nextBtn = document.querySelector('#next-btn');
                const submitSection = document.querySelector('#submit-section');
                
                // 上一题按钮
                prevBtn.disabled = currentQuestionIndex === 0;
                
                // 下一题/提交按钮
                const hasAnswer = userAnswers[currentQuestionIndex] !== null;
                nextBtn.disabled = !hasAnswer;
                
                // 最后一题显示提交按钮
                const totalQuestions = currentScaleData.questions.length;
                if (currentQuestionIndex === totalQuestions - 1) {
                    nextBtn.style.display = 'none';
                    submitSection.classList.remove('hidden');
                } else {
                    nextBtn.style.display = 'block';
                    submitSection.classList.add('hidden');
                }
            }

            // 选择选项
            function selectOption(optionValue) {
                userAnswers[currentQuestionIndex] = parseInt(optionValue);
                
                // 更新选项样式
                const options = document.querySelectorAll('.option-card');
                options.forEach(option => {
                    const isSelected = parseInt(option.dataset.value) === userAnswers[currentQuestionIndex];
                    option.classList.toggle('selected', isSelected);
                    
                    const dot = option.querySelector('.w-3.h-3');
                    dot.classList.toggle('opacity-100', isSelected);
                    dot.classList.toggle('opacity-0', !isSelected);
                });
                
                updateButtonStates();
            }

            // 上一题
            function previousQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    updatePageContent();
                }
            }

            // 下一题
            function nextQuestion() {
                if (currentQuestionIndex < currentScaleData.questions.length - 1) {
                    currentQuestionIndex++;
                    updatePageContent();
                }
            }

            // 提交测评
            function submitAssessment() {
                // 检查是否所有题目都已回答
                if (userAnswers.some(answer => answer === null)) {
                    alert('请完成所有题目后再提交');
                    return;
                }
                
                // 显示加载动画
                document.querySelector('#loading-overlay').classList.remove('hidden');
                
                // 计算总分
                const totalScore = userAnswers.reduce((sum, answer) => sum + answer, 0);
                
                // 模拟处理时间
                setTimeout(() => {
                    // 生成assessment_id
                    const assessmentId = 'assessment_' + Date.now();
                    
                    // 跳转到结果页面
                    window.location.href = `P-ASSESSMENT_RESULT.html?assessmentId=${assessmentId}&scaleId=${currentScaleId}&score=${totalScore}`;
                }, 2000);
            }

            // 事件监听器
            document.querySelector('#back-btn').addEventListener('click', function() {
                window.location.href = 'P-ASSESSMENT.html';
            });

            document.querySelector('#prev-btn').addEventListener('click', previousQuestion);
            document.querySelector('#next-btn').addEventListener('click', nextQuestion);
            document.querySelector('#submit-btn').addEventListener('click', submitAssessment);

            // 选项点击事件（使用事件委托）
            document.querySelector('#options-list').addEventListener('click', function(e) {
                const optionCard = e.target.closest('.option-card');
                if (optionCard) {
                    selectOption(optionCard.dataset.value);
                }
            });

            // 初始化页面
            initializePage();
        });
    </script>
</body>
</html>