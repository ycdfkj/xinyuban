<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæ„ˆä¼´ - å¿ƒç†å’¨è¯¢</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'glass-bg': 'rgba(255, 255, 255, 0.1)',
                        'glass-border': 'rgba(255, 255, 255, 0.2)',
                        'dark-glass': 'rgba(0, 0, 0, 0.1)',
                    },
                    backdropBlur: {
                        'xs': '2px',
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                        'glass-inset': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.4);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #ffffff, #e5e7eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .user-message {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 18px 18px 4px 18px;
        }
        
        .ai-message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px 18px 18px 4px;
        }
        
        .typing-indicator {
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        
        .theme-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .theme-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(31, 38, 135, 0.4);
        }
        
        .recording-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
    </style>
</head>
<body class="font-sans text-white overflow-x-hidden">
    <!-- iOSçŠ¶æ€æ  -->
    <div id="status-bar" class="flex justify-between items-center px-6 py-2 text-sm font-medium">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-xs"></i>
            <i class="fas fa-wifi text-xs"></i>
            <div class="w-6 h-3 border border-white rounded-sm">
                <div class="w-4 h-1.5 bg-white rounded-sm m-0.5"></div>
            </div>
        </div>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header id="top-nav" class="glass-nav flex justify-between items-center px-4 py-3">
        <button id="back-btn" class="p-2 glass-button rounded-full">
            <i class="fas fa-arrow-left text-lg"></i>
        </button>
        <h1 id="page-title" class="text-lg font-semibold gradient-text">å¿ƒç†å’¨è¯¢</h1>
        <button id="history-btn" class="p-2 glass-button rounded-full">
            <i class="fas fa-history text-lg"></i>
        </button>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div id="main-content" class="flex flex-col h-screen pb-20">
        <!-- å’¨è¯¢ä¸»é¢˜é€‰æ‹©åŒº -->
        <div id="theme-selection" class="px-4 py-6 space-y-4">
            <div class="text-center mb-6">
                <h2 class="text-xl font-bold gradient-text mb-2">é€‰æ‹©å’¨è¯¢ä¸»é¢˜</h2>
                <p class="text-white/70">é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼Œè®©æˆ‘æ›´å¥½åœ°å¸®åŠ©ä½ </p>
            </div>
            
            <div id="theme-list" class="space-y-3">
                <button id="theme-emotion" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="æƒ…ç»ªç®¡ç†">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-heart text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">æƒ…ç»ªç®¡ç†</h3>
                            <p class="text-sm text-white/70">ç„¦è™‘ã€æŠ‘éƒã€å‹åŠ›ç­‰æƒ…ç»ªé—®é¢˜</p>
                        </div>
                    </div>
                </button>
                
                <button id="theme-relationship" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="äººé™…å…³ç³»">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-users text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">äººé™…å…³ç³»</h3>
                            <p class="text-sm text-white/70">æœ‹å‹ã€åŒäº‹ã€å®¶åº­å…³ç³»</p>
                        </div>
                    </div>
                </button>
                
                <button id="theme-love" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="æ‹çˆ±å¿ƒç†">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-pink-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-heart text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">æ‹çˆ±å¿ƒç†</h3>
                            <p class="text-sm text-white/70">æ‹çˆ±å›°æƒ‘ã€æƒ…æ„Ÿé—®é¢˜</p>
                        </div>
                    </div>
                </button>
                
                <button id="theme-career" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="èŒä¸šå‘å±•">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-briefcase text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">èŒä¸šå‘å±•</h3>
                            <p class="text-sm text-white/70">å·¥ä½œå‹åŠ›ã€èŒä¸šè§„åˆ’</p>
                        </div>
                    </div>
                </button>
                
                <button id="theme-sleep" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="ç¡çœ éšœç¢">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-purple-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-moon text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">ç¡çœ éšœç¢</h3>
                            <p class="text-sm text-white/70">å¤±çœ ã€ç¡çœ è´¨é‡é—®é¢˜</p>
                        </div>
                    </div>
                </button>
                
                <button id="theme-other" class="theme-card w-full p-4 rounded-2xl text-left" data-theme="å…¶ä»–">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-ellipsis-h text-lg text-white"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold">å…¶ä»–</h3>
                            <p class="text-sm text-white/70">å…¶ä»–å¿ƒç†é—®é¢˜</p>
                        </div>
                    </div>
                </button>
            </div>
        </div>

        <!-- èŠå¤©åŒºåŸŸ -->
        <div id="chat-area" class="flex-1 flex flex-col hidden">
            <!-- èŠå¤©è®°å½•åŒº -->
            <div id="chat-messages" class="flex-1 px-4 py-4 space-y-4 overflow-y-auto">
                <!-- AIæ¬¢è¿æ¶ˆæ¯ -->
                <div id="welcome-message" class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-sm text-white"></i>
                    </div>
                    <div class="ai-message max-w-xs md:max-w-sm p-3">
                        <p class="text-sm">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„å¿ƒç†å’¨è¯¢å¸ˆã€‚æˆ‘ä¼šè®¤çœŸå€¾å¬ä½ çš„é—®é¢˜ï¼Œå¹¶ä¸ºä½ æä¾›ä¸“ä¸šçš„å¿ƒç†æ”¯æŒã€‚è¯·å‘Šè¯‰æˆ‘ä½ æœ€è¿‘é‡åˆ°äº†ä»€ä¹ˆå›°æ‰°ï¼Ÿ</p>
                    </div>
                </div>
            </div>

            <!-- æ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨ -->
            <div id="typing-indicator" class="px-4 py-2 hidden">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-sm text-white"></i>
                    </div>
                    <div class="ai-message p-3">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator"></div>
                            <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
        <div id="input-area" class="glass-card mx-4 mb-4 rounded-2xl p-4 hidden">
            <div class="flex items-end space-x-3">
                <!-- è¡¨æƒ…æŒ‰é’® -->
                <button id="emoji-btn" class="p-2 glass-button rounded-full">
                    <i class="fas fa-smile text-lg"></i>
                </button>
                
                <!-- è¯­éŸ³æŒ‰é’® -->
                <button id="voice-btn" class="p-2 glass-button rounded-full">
                    <i class="fas fa-microphone text-lg"></i>
                </button>
                
                <!-- è¾“å…¥æ¡† -->
                <div class="flex-1 relative">
                    <input type="text" id="message-input" placeholder="è¾“å…¥ä½ çš„æƒ³æ³•..." 
                           class="glass-input w-full px-4 py-3 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30">
                </div>
                
                <!-- å‘é€æŒ‰é’® -->
                <button id="send-btn" class="p-3 glass-button rounded-full">
                    <i class="fas fa-paper-plane text-lg"></i>
                </button>
            </div>
            
            <!-- å½•éŸ³çŠ¶æ€æ˜¾ç¤º -->
            <div id="recording-status" class="mt-3 text-center hidden">
                <div class="w-8 h-8 bg-danger rounded-full mx-auto mb-2 recording-animation flex items-center justify-center">
                    <i class="fas fa-microphone text-sm text-white"></i>
                </div>
                <p class="text-sm text-white/70">æ­£åœ¨å½•éŸ³... ç‚¹å‡»åœæ­¢</p>
            </div>
        </div>
    </div>

    <!-- ç»“æŸå’¨è¯¢æŒ‰é’® -->
    <button id="end-counseling-btn" class="fixed bottom-24 right-4 w-14 h-14 bg-danger rounded-full flex items-center justify-center shadow-lg hidden">
        <i class="fas fa-stop text-xl text-white"></i>
    </button>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 glass-nav flex justify-around items-center h-16 px-2 z-40">
        <a id="nav-home" href="P-HOME.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-home text-xl mb-1"></i>
            <span class="text-xs">é¦–é¡µ</span>
        </a>
        <a id="nav-counseling" href="#" class="flex flex-col items-center p-2 text-white">
            <i class="fas fa-user-md text-xl mb-1"></i>
            <span class="text-xs">å’¨è¯¢</span>
        </a>
        <a id="nav-companionship" href="P-COMPANIONSHIP.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-heart text-xl mb-1"></i>
            <span class="text-xs">é™ªä¼´</span>
        </a>
        <a id="nav-profile" href="P-PERSONAL_CENTER.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-user text-xl mb-1"></i>
            <span class="text-xs">æˆ‘çš„</span>
        </a>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let selectedTheme = null;
            let isRecording = false;
            let conversationId = null;

            // è§£æURLå‚æ•°çš„è¾…åŠ©å‡½æ•°
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const urlParams = new URLSearchParams(queryString);
                
                for(const [key, value] of urlParams.entries()) {
                    params[key] = value;
                }
                return params;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰é¢„è®¾ä¸»é¢˜
            const params = getUrlParams();
            if(params.theme_id) {
                // æ ¹æ®ä¸»é¢˜IDé€‰æ‹©å¯¹åº”çš„ä¸»é¢˜
                const themeMap = {
                    'æ‹çˆ±å¿ƒç†': 'theme-love',
                    'èŒä¸šå‘å±•ç„¦è™‘': 'theme-career'
                };
                const themeId = themeMap[params.theme_id];
                if(themeId) {
                    document.querySelector(`#${themeId}`).click();
                }
            }

            // è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#back-btn').addEventListener('click', function() {
                if(selectedTheme) {
                    // å¦‚æœæ­£åœ¨å’¨è¯¢ä¸­ï¼Œæ˜¾ç¤ºç¡®è®¤å¼¹çª—
                    if(confirm('ç¡®å®šè¦ç»“æŸå½“å‰å’¨è¯¢å—ï¼Ÿ')) {
                        window.location.href = 'P-HOME.html';
                    }
                } else {
                    window.location.href = 'P-HOME.html';
                }
            });

            // å†å²è®°å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#history-btn').addEventListener('click', function() {
                window.location.href = 'P-HISTORY.html';
            });

            // ä¸»é¢˜é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.theme-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectedTheme = this.dataset.theme;
                    startCounseling(selectedTheme);
                });
            });

            // å¼€å§‹å’¨è¯¢
            function startCounseling(theme) {
                // éšè—ä¸»é¢˜é€‰æ‹©åŒºï¼Œæ˜¾ç¤ºèŠå¤©åŒºåŸŸ
                document.querySelector('#theme-selection').classList.add('hidden');
                document.querySelector('#chat-area').classList.remove('hidden');
                document.querySelector('#input-area').classList.remove('hidden');
                document.querySelector('#end-counseling-btn').classList.remove('hidden');

                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.querySelector('#page-title').textContent = `å¿ƒç†å’¨è¯¢ - ${theme}`;

                // ç”Ÿæˆå¯¹è¯ID
                conversationId = 'conv_' + Date.now();

                // æ˜¾ç¤ºAIæ¬¢è¿æ¶ˆæ¯
                showAIMessage(`ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„å¿ƒç†å’¨è¯¢å¸ˆã€‚æˆ‘äº†è§£åˆ°ä½ æƒ³å’¨è¯¢å…³äº${theme}çš„é—®é¢˜ã€‚è¯·å‘Šè¯‰æˆ‘ä½ æœ€è¿‘é‡åˆ°äº†ä»€ä¹ˆå›°æ‰°ï¼Œæˆ‘ä¼šè®¤çœŸå€¾å¬å¹¶ä¸ºä½ æä¾›å¸®åŠ©ã€‚`);
            }

            // å‘é€æ¶ˆæ¯
            function sendMessage() {
                const input = document.querySelector('#message-input');
                const message = input.value.trim();
                
                if(message) {
                    showUserMessage(message);
                    input.value = '';
                    processAIResponse(message);
                }
            }

            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            function showUserMessage(message) {
                const chatMessages = document.querySelector('#chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex justify-end';
                messageDiv.innerHTML = `
                    <div class="user-message max-w-xs md:max-w-sm p-3">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }

            // æ˜¾ç¤ºAIæ¶ˆæ¯
            function showAIMessage(message) {
                const chatMessages = document.querySelector('#chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-sm text-white"></i>
                    </div>
                    <div class="ai-message max-w-xs md:max-w-sm p-3">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }

            // å¤„ç†AIå“åº”
            function processAIResponse(userMessage) {
                // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨
                document.querySelector('#typing-indicator').classList.remove('hidden');
                scrollToBottom();

                // æ¨¡æ‹ŸAIæ€è€ƒæ—¶é—´
                setTimeout(() => {
                    document.querySelector('#typing-indicator').classList.add('hidden');
                    
                    // ç®€å•çš„AIå“åº”é€»è¾‘ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šè°ƒç”¨AI APIï¼‰
                    let aiResponse = '';
                    
                    if(userMessage.includes('ç„¦è™‘') || userMessage.includes('å‹åŠ›')) {
                        aiResponse = 'æˆ‘ç†è§£ä½ ç°åœ¨çš„æ„Ÿå—ã€‚ç„¦è™‘å’Œå‹åŠ›æ˜¯å¾ˆå¸¸è§çš„æƒ…ç»ªååº”ã€‚è®©æˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹æ˜¯ä»€ä¹ˆå¯¼è‡´äº†è¿™äº›æ„Ÿå—ï¼Œç„¶åæ‰¾åˆ°ä¸€äº›åº”å¯¹çš„æ–¹æ³•ã€‚ä½ æ„¿æ„å’Œæˆ‘åˆ†äº«æ›´å¤šç»†èŠ‚å—ï¼Ÿ';
                    } else if(userMessage.includes('éš¾è¿‡') || userMessage.includes('ä¼¤å¿ƒ')) {
                        aiResponse = 'å¬åˆ°ä½ è¿™ä¹ˆè¯´ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆéš¾è¿‡ã€‚å…è®¸è‡ªå·±æ„Ÿå—è¿™äº›æƒ…ç»ªæ˜¯å¾ˆé‡è¦çš„ã€‚ä½ æ„¿æ„å‘Šè¯‰æˆ‘æ˜¯ä»€ä¹ˆäº‹æƒ…è®©ä½ æ„Ÿåˆ°éš¾è¿‡å—ï¼Ÿæœ‰æ—¶å€™è¯´å‡ºæ¥ä¼šæ„Ÿè§‰å¥½ä¸€äº›ã€‚';
                    } else if(userMessage.includes('æœ‹å‹') || userMessage.includes('å…³ç³»')) {
                        aiResponse = 'äººé™…å…³ç³»ç¡®å®æ˜¯æˆ‘ä»¬ç”Ÿæ´»ä¸­å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ã€‚æ¯æ®µå…³ç³»éƒ½ä¼šæœ‰æŒ‘æˆ˜ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•æ”¹å–„è¿™ç§æƒ…å†µã€‚';
                    } else {
                        aiResponse = 'è°¢è°¢ä½ å’Œæˆ‘åˆ†äº«è¿™äº›ã€‚æˆ‘åœ¨è®¤çœŸå¬ã€‚ä½ æ„¿æ„å‘Šè¯‰æˆ‘æ›´å¤šå…³äºè¿™ä¸ªæƒ…å†µçš„ç»†èŠ‚å—ï¼Ÿè¿™æ ·æˆ‘å¯ä»¥æ›´å¥½åœ°ç†è§£å¹¶å¸®åŠ©ä½ ã€‚';
                    }
                    
                    showAIMessage(aiResponse);
                }, 1500 + Math.random() * 1000);
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨
            function scrollToBottom() {
                const chatMessages = document.querySelector('#chat-messages');
                setTimeout(() => {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 100);
            }

            // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#send-btn').addEventListener('click', sendMessage);

            // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            document.querySelector('#message-input').addEventListener('keypress', function(e) {
                if(e.key === 'Enter') {
                    sendMessage();
                }
            });

            // è¯­éŸ³æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#voice-btn').addEventListener('click', function() {
                if(!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            });

            // å¼€å§‹å½•éŸ³
            function startRecording() {
                console.log('éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£å®ç°è¯­éŸ³å½•éŸ³åŠŸèƒ½');
                isRecording = true;
                document.querySelector('#voice-btn').innerHTML = '<i class="fas fa-stop text-lg"></i>';
                document.querySelector('#voice-btn').classList.add('bg-danger');
                document.querySelector('#recording-status').classList.remove('hidden');
            }

            // åœæ­¢å½•éŸ³
            function stopRecording() {
                console.log('åœæ­¢è¯­éŸ³å½•éŸ³å¹¶å¤„ç†éŸ³é¢‘æ•°æ®');
                isRecording = false;
                document.querySelector('#voice-btn').innerHTML = '<i class="fas fa-microphone text-lg"></i>';
                document.querySelector('#voice-btn').classList.remove('bg-danger');
                document.querySelector('#recording-status').classList.add('hidden');
                
                // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«ç»“æœ
                setTimeout(() => {
                    const voiceText = 'æˆ‘ä»Šå¤©æ„Ÿè§‰å‹åŠ›å¾ˆå¤§ï¼Œå·¥ä½œä¸Šçš„äº‹æƒ…è®©æˆ‘å¾ˆç„¦è™‘ã€‚';
                    showUserMessage(voiceText);
                    processAIResponse(voiceText);
                }, 500);
            }

            // è¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#emoji-btn').addEventListener('click', function() {
                console.log('éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£å®ç°è¡¨æƒ…é€‰æ‹©åŠŸèƒ½');
                // æ¨¡æ‹Ÿè¡¨æƒ…é€‰æ‹©
                const emojis = ['ğŸ˜Š', 'ğŸ˜¢', 'ğŸ˜¡', 'ğŸ˜²', 'ğŸ˜', 'ğŸ¤”'];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                showUserMessage(randomEmoji);
                processAIResponse(randomEmoji);
            });

            // ç»“æŸå’¨è¯¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelector('#end-counseling-btn').addEventListener('click', function() {
                if(confirm('ç¡®å®šè¦ç»“æŸæœ¬æ¬¡å’¨è¯¢å—ï¼Ÿæˆ‘ä»¬ä¼šä¸ºä½ ç”Ÿæˆå’¨è¯¢æ€»ç»“ã€‚')) {
                    // è·³è½¬åˆ°å’¨è¯¢å»ºè®®æ±‡æ€»é¡µ
                    window.location.href = `P-COUNSELING_SUMMARY.html?conversation_id=${conversationId}&theme=${encodeURIComponent(selectedTheme)}`;
                }
            });

            // åº•éƒ¨å¯¼èˆªæ ç‚¹å‡»äº‹ä»¶
            document.querySelector('#nav-home').addEventListener('click', function(e) {
                e.preventDefault();
                if(selectedTheme) {
                    if(confirm('ç¡®å®šè¦ç»“æŸå½“å‰å’¨è¯¢å—ï¼Ÿ')) {
                        window.location.href = 'P-HOME.html';
                    }
                } else {
                    window.location.href = 'P-HOME.html';
                }
            });

            document.querySelector('#nav-counseling').addEventListener('click', function(e) {
                e.preventDefault();
                // å·²åœ¨å’¨è¯¢é¡µé¢ï¼Œæ— éœ€æ“ä½œ
            });

            document.querySelector('#nav-companionship').addEventListener('click', function(e) {
                e.preventDefault();
                if(selectedTheme) {
                    if(confirm('ç¡®å®šè¦ç»“æŸå½“å‰å’¨è¯¢å—ï¼Ÿ')) {
                        window.location.href = 'P-COMPANIONSHIP.html';
                    }
                } else {
                    window.location.href = 'P-COMPANIONSHIP.html';
                }
            });

            document.querySelector('#nav-profile').addEventListener('click', function(e) {
                e.preventDefault();
                if(selectedTheme) {
                    if(confirm('ç¡®å®šè¦ç»“æŸå½“å‰å’¨è¯¢å—ï¼Ÿ')) {
                        window.location.href = 'P-PERSONAL_CENTER.html';
                    }
                } else {
                    window.location.href = 'P-PERSONAL_CENTER.html';
                }
            });
        });
    </script>
</body>
</html>