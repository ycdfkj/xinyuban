<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæ„ˆä¼´ - æƒ…æ„Ÿé™ªä¼´</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'glass-bg': 'rgba(255, 255, 255, 0.1)',
                        'glass-border': 'rgba(255, 255, 255, 0.2)',
                        'dark-glass': 'rgba(0, 0, 0, 0.1)',
                    },
                    backdropBlur: {
                        'xs': '2px',
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                        'glass-inset': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.4);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #ffffff, #e5e7eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .chat-container {
            height: calc(100vh - 200px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
        
        .user-message {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .ai-message {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(31, 38, 135, 0.2);
        }
        
        .typing-indicator {
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        
        .recording-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="font-sans text-white overflow-hidden">
    <!-- iOSçŠ¶æ€æ  -->
    <div id="status-bar" class="flex justify-between items-center px-6 py-2 text-sm font-medium">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-xs"></i>
            <i class="fas fa-wifi text-xs"></i>
            <div class="w-6 h-3 border border-white rounded-sm">
                <div class="w-4 h-1.5 bg-white rounded-sm m-0.5"></div>
            </div>
        </div>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header id="top-nav" class="flex justify-between items-center px-4 py-3">
        <button id="back-btn" class="p-2 glass-button rounded-full hover:scale-105 transition-transform">
            <i class="fas fa-arrow-left text-lg"></i>
        </button>
        <h1 id="page-title" class="text-lg font-semibold gradient-text">æƒ…æ„Ÿé™ªä¼´</h1>
        <button id="end-companionship-btn" class="px-4 py-2 glass-button rounded-full text-sm font-medium hover:scale-105 transition-transform">
            <i class="fas fa-phone-slash mr-2"></i>ç»“æŸé™ªä¼´
        </button>
    </header>

    <!-- èŠå¤©è®°å½•åŒºåŸŸ -->
    <div id="chat-container" class="chat-container px-4 pb-4">
        <div id="chat-messages" class="space-y-4">
            <!-- æ¬¢è¿æ¶ˆæ¯ -->
            <div id="welcome-message" class="flex items-start space-x-3">
                <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-heart text-lg text-white"></i>
                </div>
                <div class="ai-message rounded-2xl rounded-tl-md px-4 py-3 max-w-xs">
                    <p class="text-sm">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±é™ªä¼´ä¼™ä¼´ï¼Œä»Šå¤©æƒ³èŠäº›ä»€ä¹ˆå‘¢ï¼ŸğŸ˜Š</p>
                </div>
            </div>
            
            <!-- ç¤ºä¾‹å¯¹è¯ -->
            <div id="example-user-message" class="flex items-start space-x-3 justify-end hidden">
                <div class="user-message rounded-2xl rounded-tr-md px-4 py-3 max-w-xs">
                    <p class="text-sm text-white">ä»Šå¤©å·¥ä½œå¥½ç´¯ï¼Œæ„Ÿè§‰å¾ˆå­¤ç‹¬...</p>
                </div>
            </div>
            
            <div id="example-ai-response" class="flex items-start space-x-3 hidden">
                <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-heart text-lg text-white"></i>
                </div>
                <div class="ai-message rounded-2xl rounded-tl-md px-4 py-3 max-w-xs">
                    <p class="text-sm">æˆ‘ç†è§£è¿™ç§æ„Ÿè§‰ï¼Œå·¥ä½œå‹åŠ›ç¡®å®ä¼šè®©äººæ„Ÿåˆ°ç–²æƒ«ã€‚ä½ æ„¿æ„å’Œæˆ‘åˆ†äº«æ›´å¤šå—ï¼Ÿæˆ‘åœ¨è¿™é‡Œå€¾å¬ä½ ã€‚â¤ï¸</p>
                </div>
            </div>
            
            <!-- æ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨ -->
            <div id="typing-indicator" class="flex items-start space-x-3 hidden">
                <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-heart text-lg text-white"></i>
                </div>
                <div class="ai-message rounded-2xl rounded-tl-md px-4 py-3">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator"></div>
                        <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-white/60 rounded-full typing-indicator" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
    <div id="input-area" class="fixed bottom-0 left-0 right-0 glass-card p-4">
        <div class="flex items-center space-x-3">
            <!-- è¡¨æƒ…æŒ‰é’® -->
            <button id="emoji-btn" class="p-2 glass-button rounded-full hover:scale-105 transition-transform">
                <i class="fas fa-smile text-lg"></i>
            </button>
            
            <!-- è¾“å…¥æ¡† -->
            <div class="flex-1 relative">
                <input 
                    type="text" 
                    id="message-input" 
                    placeholder="è¾“å…¥æ¶ˆæ¯..." 
                    class="w-full px-4 py-3 bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/40"
                >
            </div>
            
            <!-- è¯­éŸ³æŒ‰é’® -->
            <button id="voice-btn" class="p-2 glass-button rounded-full hover:scale-105 transition-transform">
                <i class="fas fa-microphone text-lg"></i>
            </button>
            
            <!-- å‘é€æŒ‰é’® -->
            <button id="send-btn" class="p-2 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full hover:scale-105 transition-transform">
                <i class="fas fa-paper-plane text-lg text-white"></i>
            </button>
        </div>
        
        <!-- å½•éŸ³çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div id="recording-indicator" class="mt-3 text-center hidden">
            <div class="inline-flex items-center space-x-2 glass-button rounded-full px-4 py-2">
                <div class="w-3 h-3 bg-danger rounded-full recording-animation"></div>
                <span class="text-sm">æ­£åœ¨å½•éŸ³...</span>
                <span id="recording-time" class="text-sm text-white/70">00:00</span>
            </div>
        </div>
    </div>

    <!-- è¡¨æƒ…é€‰æ‹©å™¨ -->
    <div id="emoji-picker" class="fixed bottom-24 left-4 right-4 glass-card rounded-2xl p-4 hidden z-50">
        <div class="flex justify-between items-center mb-3">
            <h3 class="font-semibold">è¡¨æƒ…</h3>
            <button id="close-emoji-btn" class="p-1">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="emoji-grid" class="grid grid-cols-8 gap-3">
            <!-- å¸¸ç”¨è¡¨æƒ… -->
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜¢">ğŸ˜¢</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜¡">ğŸ˜¡</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="â¤ï¸">â¤ï¸</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ‘">ğŸ‘</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ‰">ğŸ‰</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ’ª">ğŸ’ª</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜´">ğŸ˜´</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜">ğŸ˜</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ¤”">ğŸ¤”</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜">ğŸ˜</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ¤—">ğŸ¤—</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜±">ğŸ˜±</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ¤£">ğŸ¤£</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ˜˜">ğŸ˜˜</button>
            <button class="emoji-btn p-2 hover:bg-white/20 rounded-lg transition-colors" data-emoji="ğŸ™">ğŸ™</button>
        </div>
    </div>

    <!-- ç»“æŸé™ªä¼´ç¡®è®¤å¼¹çª— -->
    <div id="end-confirmation-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 hidden z-50">
        <div class="glass-card rounded-3xl p-6 w-full max-w-sm">
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-phone-slash text-2xl text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">ç»“æŸé™ªä¼´</h3>
                <p class="text-sm text-white/70 mb-6">ç¡®å®šè¦ç»“æŸå½“å‰çš„é™ªä¼´ä¼šè¯å—ï¼Ÿ</p>
                <div class="flex space-x-3">
                    <button id="cancel-end-btn" class="flex-1 py-3 glass-button rounded-xl font-medium">å–æ¶ˆ</button>
                    <button id="confirm-end-btn" class="flex-1 py-3 bg-gradient-to-br from-pink-400 to-pink-600 rounded-xl font-medium text-white">ç¡®å®šç»“æŸ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 glass-nav flex justify-around items-center h-16 px-2 z-40">
        <a id="nav-home" href="P-HOME.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-home text-xl mb-1"></i>
            <span class="text-xs">é¦–é¡µ</span>
        </a>
        <a id="nav-counseling" href="P-COUNSELING.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-user-md text-xl mb-1"></i>
            <span class="text-xs">å’¨è¯¢</span>
        </a>
        <a id="nav-companionship" href="#" class="flex flex-col items-center p-2 text-white">
            <i class="fas fa-heart text-xl mb-1"></i>
            <span class="text-xs">é™ªä¼´</span>
        </a>
        <a id="nav-profile" href="P-PERSONAL_CENTER.html" class="flex flex-col items-center p-2 text-white/60 hover:text-white transition-colors">
            <i class="fas fa-user text-xl mb-1"></i>
            <span class="text-xs">æˆ‘çš„</span>
        </a>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.querySelector('#chat-container');
            const chatMessages = document.querySelector('#chat-messages');
            const messageInput = document.querySelector('#message-input');
            const sendBtn = document.querySelector('#send-btn');
            const emojiBtn = document.querySelector('#emoji-btn');
            const voiceBtn = document.querySelector('#voice-btn');
            const backBtn = document.querySelector('#back-btn');
            const endCompanionshipBtn = document.querySelector('#end-companionship-btn');
            const emojiPicker = document.querySelector('#emoji-picker');
            const closeEmojiBtn = document.querySelector('#close-emoji-btn');
            const endConfirmationModal = document.querySelector('#end-confirmation-modal');
            const cancelEndBtn = document.querySelector('#cancel-end-btn');
            const confirmEndBtn = document.querySelector('#confirm-end-btn');
            const recordingIndicator = document.querySelector('#recording-indicator');
            const recordingTime = document.querySelector('#recording-time');
            
            let isRecording = false;
            let recordingTimer = null;
            let recordingSeconds = 0;
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            function scrollToBottom() {
                setTimeout(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 100);
            }
            
            // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
            function addMessage(content, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = isUser 
                    ? 'flex items-start space-x-3 justify-end'
                    : 'flex items-start space-x-3';
                
                if (isUser) {
                    messageDiv.innerHTML = `
                        <div class="user-message rounded-2xl rounded-tr-md px-4 py-3 max-w-xs">
                            <p class="text-sm text-white">${content}</p>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-pink-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-heart text-lg text-white"></i>
                        </div>
                        <div class="ai-message rounded-2xl rounded-tl-md px-4 py-3 max-w-xs">
                            <p class="text-sm">${content}</p>
                        </div>
                    `;
                }
                
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
            }
            
            // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨
            function showTypingIndicator() {
                const typingIndicator = document.querySelector('#typing-indicator');
                typingIndicator.classList.remove('hidden');
                scrollToBottom();
            }
            
            // éšè—æ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨
            function hideTypingIndicator() {
                const typingIndicator = document.querySelector('#typing-indicator');
                typingIndicator.classList.add('hidden');
            }
            
            // æ¨¡æ‹ŸAIå›åº”
            function simulateAIResponse(userMessage) {
                showTypingIndicator();
                
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    // ç®€å•çš„AIå›åº”é€»è¾‘
                    let aiResponse = '';
                    if (userMessage.includes('ç´¯') || userMessage.includes('ç–²æƒ«')) {
                        aiResponse = 'æˆ‘ç†è§£è¿™ç§æ„Ÿè§‰ï¼Œå·¥ä½œå‹åŠ›ç¡®å®ä¼šè®©äººæ„Ÿåˆ°ç–²æƒ«ã€‚ä½ æ„¿æ„å’Œæˆ‘åˆ†äº«æ›´å¤šå—ï¼Ÿæˆ‘åœ¨è¿™é‡Œå€¾å¬ä½ ã€‚â¤ï¸';
                    } else if (userMessage.includes('å­¤ç‹¬') || userMessage.includes('å­¤å•')) {
                        aiResponse = 'å­¤ç‹¬çš„æ„Ÿè§‰ç¡®å®ä¸å¥½å—ï¼Œä½†è¯·è®°ä½ï¼Œä½ å¹¶ä¸å­¤å•ã€‚æˆ‘ä¼šä¸€ç›´åœ¨è¿™é‡Œé™ªä¼´ç€ä½ ã€‚ğŸ˜Š';
                    } else if (userMessage.includes('å¼€å¿ƒ') || userMessage.includes('é«˜å…´')) {
                        aiResponse = 'å¬åˆ°ä½ å¼€å¿ƒæˆ‘ä¹Ÿå¾ˆé«˜å…´ï¼èƒ½å’Œæˆ‘åˆ†äº«ä¸€ä¸‹è®©ä½ å¼€å¿ƒçš„äº‹æƒ…å—ï¼ŸğŸ‰';
                    } else {
                        aiResponse = 'è°¢è°¢ä½ å’Œæˆ‘åˆ†äº«è¿™äº›ã€‚æˆ‘åœ¨è¿™é‡Œæ”¯æŒä½ ï¼Œæ— è®ºä½ æƒ³èŠä»€ä¹ˆéƒ½å¯ä»¥ã€‚';
                    }
                    
                    addMessage(aiResponse, false);
                }, 1500 + Math.random() * 1000);
            }
            
            // å‘é€æ¶ˆæ¯
            function sendMessage() {
                const content = messageInput.value.trim();
                if (!content) return;
                
                addMessage(content, true);
                messageInput.value = '';
                simulateAIResponse(content);
            }
            
            // å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            sendBtn.addEventListener('click', sendMessage);
            
            // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // è¡¨æƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            emojiBtn.addEventListener('click', function() {
                emojiPicker.classList.toggle('hidden');
                if (!emojiPicker.classList.contains('hidden')) {
                    scrollToBottom();
                }
            });
            
            // å…³é—­è¡¨æƒ…é€‰æ‹©å™¨
            closeEmojiBtn.addEventListener('click', function() {
                emojiPicker.classList.add('hidden');
            });
            
            // è¡¨æƒ…é€‰æ‹©äº‹ä»¶
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const emoji = this.dataset.emoji;
                    messageInput.value += emoji;
                    emojiPicker.classList.add('hidden');
                    messageInput.focus();
                });
            });
            
            // è¯­éŸ³æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            voiceBtn.addEventListener('click', function() {
                if (!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            });
            
            // å¼€å§‹å½•éŸ³
            function startRecording() {
                console.log('éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£å®ç°è¯­éŸ³å½•éŸ³åŠŸèƒ½');
                isRecording = true;
                recordingSeconds = 0;
                
                // æ›´æ–°UI
                voiceBtn.innerHTML = '<i class="fas fa-stop text-lg text-danger"></i>';
                voiceBtn.classList.add('recording-animation');
                recordingIndicator.classList.remove('hidden');
                
                // å¼€å§‹è®¡æ—¶
                recordingTimer = setInterval(() => {
                    recordingSeconds++;
                    const minutes = Math.floor(recordingSeconds / 60);
                    const seconds = recordingSeconds % 60;
                    recordingTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
            
            // åœæ­¢å½•éŸ³
            function stopRecording() {
                console.log('åœæ­¢è¯­éŸ³å½•éŸ³');
                isRecording = false;
                
                // æ›´æ–°UI
                voiceBtn.innerHTML = '<i class="fas fa-microphone text-lg"></i>';
                voiceBtn.classList.remove('recording-animation');
                recordingIndicator.classList.add('hidden');
                
                // æ¸…é™¤è®¡æ—¶å™¨
                if (recordingTimer) {
                    clearInterval(recordingTimer);
                    recordingTimer = null;
                }
                
                // æ¨¡æ‹Ÿè¯­éŸ³æ¶ˆæ¯
                if (recordingSeconds > 0) {
                    addMessage('[è¯­éŸ³æ¶ˆæ¯]', true);
                    setTimeout(() => {
                        addMessage('æˆ‘å¬åˆ°äº†ä½ çš„è¯­éŸ³ï¼Œè°¢è°¢ä½ å’Œæˆ‘åˆ†äº«ã€‚ä½ æƒ³ç»§ç»­èŠè¿™ä¸ªè¯é¢˜å—ï¼Ÿ', false);
                    }, 1000);
                }
            }
            
            // è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            backBtn.addEventListener('click', function() {
                window.location.href = 'P-HOME.html';
            });
            
            // ç»“æŸé™ªä¼´æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            endCompanionshipBtn.addEventListener('click', function() {
                endConfirmationModal.classList.remove('hidden');
            });
            
            // å–æ¶ˆç»“æŸé™ªä¼´
            cancelEndBtn.addEventListener('click', function() {
                endConfirmationModal.classList.add('hidden');
            });
            
            // ç¡®è®¤ç»“æŸé™ªä¼´
            confirmEndBtn.addEventListener('click', function() {
                endConfirmationModal.classList.add('hidden');
                window.location.href = 'P-HOME.html';
            });
            
            // åº•éƒ¨å¯¼èˆªæ ç‚¹å‡»äº‹ä»¶
            document.querySelector('#nav-home').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-HOME.html';
            });
            
            document.querySelector('#nav-counseling').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-COUNSELING.html';
            });
            
            document.querySelector('#nav-companionship').addEventListener('click', function(e) {
                e.preventDefault();
                // å·²åœ¨é™ªä¼´é¡µé¢ï¼Œæ— éœ€æ“ä½œ
            });
            
            document.querySelector('#nav-profile').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-PERSONAL_CENTER.html';
            });
            
            // ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­è¡¨æƒ…é€‰æ‹©å™¨
            document.addEventListener('click', function(e) {
                if (!emojiPicker.contains(e.target) && !emojiBtn.contains(e.target)) {
                    emojiPicker.classList.add('hidden');
                }
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            endConfirmationModal.addEventListener('click', function(e) {
                if (e.target === endConfirmationModal) {
                    endConfirmationModal.classList.add('hidden');
                }
            });
            
            // åˆå§‹åŒ–æ»šåŠ¨åˆ°åº•éƒ¨
            scrollToBottom();
            
            // é¡µé¢åŠ è½½åŠ¨ç”»
            setTimeout(() => {
                document.querySelector('#welcome-message').style.opacity = '0';
                document.querySelector('#welcome-message').style.transform = 'translateY(20px)';
                document.querySelector('#welcome-message').style.transition = 'all 0.6s ease';
                setTimeout(() => {
                    document.querySelector('#welcome-message').style.opacity = '1';
                    document.querySelector('#welcome-message').style.transform = 'translateY(0)';
                }, 100);
            }, 500);
        });
    </script>
</body>
</html>